<div data-controller="map" class="relative w-full h-full"
     data-map-current-user-id="<%= current_user.id %>">
  <!-- Filter Controls -->
  <div class="absolute top-4 right-4 z-50">
    <!-- Search Toggle Button (Mobile) -->
    <button type="button"
            class="md:hidden bg-white/90 backdrop-blur-sm rounded-lg shadow p-2 hover:bg-white transition-colors"
            data-map-target="searchToggle"
            data-action="click->map#toggleSearch"
            aria-label="Toggle search">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </button>

    <!-- Search Box -->
    <div id="map-search"
         class="hidden md:block bg-white/90 backdrop-blur-sm rounded-lg shadow p-4 transition-all duration-200 absolute top-0 right-0 landscape:md:static"
         data-map-target="searchBox">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-sm font-medium text-gray-700 md:hidden">Search</h3>
        <button type="button"
                class="md:hidden p-1 rounded hover:bg-gray-100 focus:outline-none"
                data-action="click->map#toggleSearch"
                aria-label="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <input type="text"
             placeholder="Search address or resident nameâ€¦"
             data-map-target="searchInput"
             data-action="input->map#applySearch"
             class="w-64 border-gray-300 border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <div class="mt-2">
        <label class="text-sm font-medium inline-flex items-center gap-2 cursor-pointer">
          <input type="checkbox"
                 data-map-target="newResidentsToggle"
                 data-action="change->map#updateHighlight change->map#toggleNewResidentsList"
                 class="rounded" />
          <span class="flex items-center gap-1">
            New residents (30 days)
            <svg data-map-target="newResidentsChevron" 
                 class="w-4 h-4 text-gray-500 transition-transform duration-200" 
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"></path>
            </svg>
          </span>
        </label>
        
        <!-- Expandable New Residents List -->
        <div data-map-target="newResidentsList" 
             class="hidden mt-3 pl-6 space-y-3 text-sm border-l-2 border-gray-200 bg-gray-50/50 rounded-r p-3 max-h-64 overflow-y-auto">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Map Container -->
  <div data-map-target="canvas" class="map-fullscreen"></div>

  <!-- Modal Container -->
  <div data-map-target="modal"
    role="dialog"
    aria-modal="true"
    class="fixed inset-0 md:inset-auto md:top-0 md:right-0 h-screen w-full landscape:w-1/2 md:w-1/3 md:max-w-xl bg-white shadow-2xl p-8 md:rounded-bl-lg transition-width duration-300 overflow-y-auto overscroll-contain touch-pan-y"
    style="display:none; z-index:2000;"></div>
</div>
